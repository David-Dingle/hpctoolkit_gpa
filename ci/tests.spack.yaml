spack:
  view: false
  concretizer:
    unify: false
    reuse: dependencies

  develop:
    hpctoolkit:
      path: '..'
      spec: hpctoolkit@2024.01.stable-ci

  definitions:
  - when: env["BUILDSYS"] == "autotools"
    buildsys:
    - build_system=autotools ~debug
  - when: env["BUILDSYS"] == "meson"
    buildsys:
    - build_system=meson buildtype=release

  specs:
  - matrix:
    - - hpctoolkit@=2024.01.stable-ci
    - [$buildsys]
    - - ~viewer ~mpi +opencl ~cuda ~rocm ~level_zero
    - [+papi, ~papi]

  mirrors:
    upstream-cache:
      url: oci://registry.gitlab.com/hpctoolkit/hpctoolkit/spack-buildcache/v0.21
      binary: true
      source: false
