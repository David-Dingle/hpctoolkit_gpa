spack:
  concretizer:
    unify: true

  definitions:
  - target_specific: []
  - when: arch.satisfies('target=x86_64:')
    target_specific:
    - intel-xed +pic @2022.04.17

  specs:
  # Build-time packages
  - autoconf @2.69
  - automake @1.15.1
  - libtool @2.4.6
  - m4
  - 'gmake @4.3:'

  # Libmonitor
  - libmonitor @2021.11.08 +hpctoolkit ~dlopen

  # Remaining dependencies
  # TODO: Reduce this to include only what WE directly depend on.
  - papi @6.0.0.1
  - libpfm4 @4.11.0

  - boost @1.77.0
    +atomic +date_time +filesystem +system +thread +timer +graph +regex
    +shared +multithreaded
    ~debug ~mpi ~python ~iostreams ~numpy
    visibility=global

  - libiberty @2.37
  - elfutils ~nls @0.186
  - dyninst +openmp @12.3.0
  - intel-tbb +shared +tm @2020.3

  - bzip2 @1.0.8
  - xz +pic @5.2.5
  - zlib +optimize +shared @1.2.13

  - libunwind +xz +pic @1.6.2
  - xerces-c transcoder=iconv @3.2.3
  - memkind

  - opencl-c-headers @2022.01.04

  - yaml-cpp @0.7.0

  # MPI
  - openmpi @4.1.5

  # Special dependencies for the tests2 suite
  - python @3.10
  - meson @0.64.0
  - py-poetry-core @1.2.0
  - py-pytest @7.1.3
  - py-ruamel-yaml @0.17.16
  - py-click @8.1.3
  - py-pyparsing @3.0.9

  - $target_specific

  view:
    default:
      root: view
      link: run

    unified:
      root: view-unified
      link: roots
      exclude:
      - autoconf
      - automake
      - gmake
      - libpfm4
      - libtool
      - m4
      - papi

    papi:
      root: view-papi
      link: roots
      select:
      - papi

    perfmon:
      root: view-perfmon
      link: roots
      select:
      - libpfm4

  # Reuse packages from the public buildcache whenever possible
  mirrors:
    develop: 's3://spack-binaries/develop'
